---
title: "Nutrition and COVID-19 Outcomes"
subtitle: "Does Deviation from USDA Nutritional Guidelines by Country Correlate With COVID Recovery Rates?"
author: "Yay Stats <br> Arthi Vaidyanathan and Denise Shkurovich"
institute: "Duke University"
date: "`r Sys.Date()`"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      ratio: "16:9"
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r load-packages, include = FALSE}
# Add any additional packages you need to this chunk
# Remove any packages from this list that you're not using
library(tidyverse)
library(tidymodels)
library(palmerpenguins)
library(knitr)
library(xaringanthemer)
```

```{r setup, include=FALSE}
# For better figure resolution
knitr::opts_chunk$set(
  fig.retina = 3, 
  dpi = 300, 
  fig.width = 6, 
  fig.asp = 0.618, 
  out.width = "70%"
  )
```

```{r load-data, include=FALSE}
food <- readr::read_csv("data/Food_Supply_kcal_Data.csv")
```

```{r style-slides, echo = FALSE}
style_xaringan(
  title_slide_background_image = "presentation/covidpic.jpeg"
)
```

class: inverse, middle, center

---

## Research Question

How does nutrition impact recovery from COVID-19 infections?

--
### Why do we care?
--

- Previous studies show that maintaining a healthy diet can decrease risk of severe infection by promoting the immune system (Messina et al. 2020, Iddir et. al 2020).

--

- Adequate protein consumption is essential for antibody production and poor nutrient consumption has been shown to increase inflammation and oxidative stress (Iddir et. al 2020).

--

- There is an observed increase in mortality rates among patients infected with COVID-19 which have chronic inflammatory diseases such as obesity, diabetes, and hypertension. The prevalence of these chronic inflammatory diseases are known to be correlated with an individual's diet (Onishi 2020).

---

## Source and Analysis Plan

--

### Dataset:

--

- "COVID-19 Healthy Diet Dataset” comes from Kaggle. 

--

- Energy intake (kcal) as percentages of total diet by food group. 

--

- Provides data for total confirmed COVID-19 cases, recovered COVID cases, COVID deaths, and active COVID cases for 170 countries.

--

### Analysis Plan:

--
- The USDA Center for Nutrition Policy and Promotion suggests a dietary intake which consists of 30% grains, 40% vegetable, 10% fruits, and 20% proteins

--

- We want to see if the dietary of breakdown of countries aligns with the USDA suggested values

--

- Whether deviation or adherance to this suggested breakdown impacts COVID-19 recovery rates

---
# Preliminary Visualizations

```{r make_food_categories, message=FALSE, echo = FALSE, warning=FALSE}
food <- food %>% 
  mutate(Grains = `Cereals - Excluding Beer` + `Starchy Roots`) %>% 
  mutate(Vegetables2 = Pulses + `Vegetal Products` + Vegetables) %>% 
  mutate(Fruits = `Fruits - Excluding Wine`) %>% 
  mutate(Fats = `Animal fats` + Oilcrops + Treenuts + `Vegetable Oils`) %>% 
  mutate(Protein = `Animal Products` + Eggs + `Fish, Seafood` + Meat + `Milk - Excluding Butter` + Offals) %>% 
  mutate('Alcohol/Stimulants' = `Alcoholic Beverages` + Stimulants) %>% 
  mutate(Other = `Aquatic Products, Other` + Miscellaneous + Spices + `Sugar Crops` + `Sugar & Sweeteners`)
```

--

.pull-left[
```{r countries-mean-graph, out.width="100%", fig.width=4, message=FALSE, echo = FALSE, warning=FALSE}

meanfood <- food %>%
  summarize(Group = "Countries", meangrains = mean(Grains), meanveg = mean(Vegetables2), meanfruit = mean(Fruits), meanfat = mean(Fats), meanprotein = mean(Protein), meanother = mean(Other)) %>% 
 add_row(Group = "USDA", meangrains=30, meanveg=40, meanfruit=10, meanprotein=20) %>% 
    pivot_longer(cols=meangrains:meanother, names_to = "Means", values_to = "PercentDiet")

meanfood %>%
  ggplot(aes(x=Means, y=PercentDiet, fill=Group))+geom_col(position="dodge") + labs(x="Food Group", y="Percent of Total Diet Composition", title="Avergae Diet Make up by Food Group", subtitle="Compared to USDA suggested diet") + theme(axis.text.x = element_text(angle = 45, vjust = 0.5))

```
]

```{r countries, echo = FALSE, warning=FALSE, message=FALSE}
food <- food %>% #grouping each country by their income classification group
  mutate(income = ifelse(Country %in% c("Afghanistan","Burkina Faso", "Central African Republic", "Chad", "Congo", "Ethiopia", "Gambia", "Guinea", "Guinea-Bissau", "Korea, Dem. People's Rep", "Liberia", "Madagascar", "Malawi", "Mali", "Mozambique", "Rwanda", "Sierra Leone", "Sudan", "Togo", "Uganda", "Yemen"),"LIC", 
                         ifelse(Country %in% c("Algeria","Angola","Bangladesh", "Belize", "Benin", "Bolivia", "Cabo Verde", "Cambodia", "Cameroon", "Cote d'Ivoire", "Djibouti", "Egypt", "El Salvador", "Eswatini", "Ghana", "Haiti", "Honduras", "India", "Indonesia", "Iran (Islamic Republic of)", "Kenya", "Kiribati", "Kyrgyzstan", "Lao People's Democratic Republic", "Lesotho", "Mauritania", "Mongolia", "Morocco", "Myanmar", "Nepal", "Nicaragua", "Niger", "Nigeria", "	
Pakistan", "Samoa", "Sao Tome and Principe", "Senegal", "Solomon Islands","Sri Lanka", "Suriname", "Tajikistan", "Timor-Leste", "Tunisia", "Ukraine", "United Republic of Tanzania", "Uzbekistan", "Vanuatu", "Vietnam", "Zambia", "Zimbabwe"), "LMIC", 
                         ifelse(Country %in% c("Albania","Argentina","Armenia","Azerbaijan", "Belarus","Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "China", "Colombia", "Costa Rica", "Cuba", "Dominica", "Dominican Republic", "Ecuador", "Fiji", "Gabon", "Georgia", "Grenada", "Guatemala", "Guyana", "Iraq", "Jamaica", "Jordan", "Kazakhstan", "Lebanon", "Malaysia", "Maldives", "Mauritius", "Mexico", "Montenegro","Namibia", "North Macedonia", "	
Panama", "Paraguay", "Peru", "Philippines", "Republic of Moldova", "Romania", "Russian Federation", "Saint Lucia", "Saint Vincent and the Grenadines", "Serbia", "Senegal", "South Africa", "Thailand", "Turkey", "Turkmenistan", "Venezuela (Bolivarian Republic of)"),
             "UMIC", "HIC"))))
```

--

.pull-right[
```{r comparing_dietary_means_to_USDA, out.width="100%", fig.width=4, message=FALSE, echo = FALSE, warning=FALSE}
meanfoodincome <- food %>%
  group_by(income) %>%
  summarize(meangrains = mean(Grains), meanveg = mean(Vegetables2), meanfruit = mean(Fruits), meanfat = mean(Fats), meanprotein = mean(Protein), meanother = mean(Other)) %>% 
  add_row(income="USDA", meangrains=30, meanveg=40, meanfruit=10, meanprotein=20) %>% 
  pivot_longer(cols=meangrains:meanother, names_to = "Means", values_to = "PercentDiet") 

meanfoodincome %>%
  mutate(income = fct_relevel(income, 
            "HIC", "UMIC", "LMIC", 
            "LIC", "USDA")) %>%
  ggplot(aes(x=Means, y=PercentDiet, fill=income))+geom_col(position="dodge") + labs(x="Food Group", y="Percent of Total Diet Composition", title="Diet Composition by Food Group") + theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```
]

--

.footnote[
Overall ANOVA tests indicate that at least one mean food group varies in each income group in all food groups except for Fruit

]

---

## Recovery Rate

- Created variable called 'Recovery Rate', calculated as Percent of Population Recovered from COVID-19/ Percent of Population Confirmed to have COVID-19

--

```{r box-plot, massage = FALSE, echo = FALSE, fig.height = 3, fig.width = 7, warning=FALSE, fig.align = "center"}
food <- food %>%
  mutate(rec_rate=Recovered/Confirmed) %>% 
  filter(rec_rate > 0)

food %>%
  mutate(income = fct_relevel(income, 
            "HIC", "UMIC", "LMIC", 
            "LIC", "USDA")) %>%
  ggplot(aes(x = rec_rate, fill = income)) + geom_boxplot() + labs(y = NULL, x = "Percent Recovery for Confirmed COVID Cases", fill = "Income Status", title = "Boxplot Showing COVID Recovery Data Group 
by Country Income Status")
```

---

## Linear Regression Model to Assess Effects of Diet on COVID-19 Recovery Rates

--

```{r creating_deviation_varibles, echo = FALSE, message=FALSE, warning=FALSE}
food <- food %>% 
  mutate(deviation_grains = (30 - Grains)^2) %>% 
  mutate(deviation_veg = (40 - Vegetables2)^2) %>% 
  mutate(deviation_fruit = (10 - Fruits)^2) %>% 
  mutate(deviation_protein = (20 - Protein)^2) %>% 
  mutate(deviation_tot = deviation_grains + deviation_protein + deviation_fruit + deviation_veg) %>% 
  filter(rec_rate>0)
```

```{r graphs_of_deviation_vs_recovery_rate, message=FALSE, echo = FALSE, warning=FALSE, fig.align = "center", fig.height = 2, fig.width = 5}
food %>% 
  filter(deviation_tot<750) %>% 
ggplot(aes(x = deviation_tot, y = rec_rate)) +
  geom_point()+geom_smooth(method="lm") + labs(
    title = "COVID-19 Recovery Rate in relationship to deviation from USDA 
    suggested Dietary Intake",
    x = "Deviation from USDA suggested diet",
    y = "COVID-19 Recovery Rate")
```

---
# Linear Regression Model
--
```{r Linear_Model_no_income, echo = FALSE, warning=FALSE, message=FALSE}
res <- linear_reg() %>%
  set_engine("lm") %>%
  fit(rec_rate ~ deviation_tot, data = food) %>% 
  tidy() %>% 
  print()
```
--
## Adjusted R Squared
```{r Linear_Model_no_income_r2, echo = FALSE, warning=FALSE, message=FALSE}
linear<-lm(rec_rate~deviation_tot, data=food)
glance(linear)$adj.r.squared %>% 
  print()
```

--

- This linear regression model shows that there is a significant relationship between recovery rate and deviation rate since our p value is less than the alpha level of 0.05. For every integer increase in deviation rate, the chances of recovering are on average 0.0002 lower.

--

- However, the adjusted r squared value is quite low. It indicates that our model only accounts for 2.8% of the variance in the data. 
---
### Linear Regression Conditioning Income and Dietary Deviation

.pull-left[
```{r lgraphs_of_deviation_vs_recovery_rate, message=FALSE, echo = FALSE, warning=FALSE}
food %>% 
  filter(deviation_tot<750) %>% 
ggplot(aes(x = deviation_tot, y = rec_rate)) +
  geom_point()+geom_smooth(method="lm") + labs(
    title = "COVID-19 Recovery Rate in relationship to deviation from USDA 
    suggested Dietary Intake",
    x = "Deviation from USDA suggested diet",
    y = "COVID-19 Recovery Rate")
```
]

--

.pull-right[
```{r lLinear_Model_with_income_graph, echo = FALSE, warning=FALSE, message=FALSE}
food %>% 
  filter(deviation_tot<750) %>% 
ggplot(aes(x = deviation_tot, y = rec_rate, color=income)) +
  geom_point()+geom_smooth(method="lm", se = FALSE) + labs(
    title = "COVID-19 Recovery Rate in relationship to deviation from USDA suggested Dietary Intake",
    x = "Deviation from USDA suggested diet",
    y = "COVID-19 Recovery Rate")
```
]

---

#### Linear Regression Model without income
```{r lLinear_Model_no_income, echo = FALSE, warning=FALSE, message=FALSE}
res <- linear_reg() %>%
  set_engine("lm") %>%
  fit(rec_rate ~ deviation_tot, data = food) %>% 
  tidy() %>% 
  print()
```

--

#### Linear Regression Model with income
```{r lLinear_Model_with_income, echo = FALSE, warning=FALSE, message=FALSE}
resincome <- linear_reg() %>%
  set_engine("lm") %>%
  fit(rec_rate ~ deviation_tot+income, data = food) %>% 
  tidy () %>% 
  print()
```

--

- We cannot reject the null hypothesis that there is no relationship between COVID recovery rate and dietary deviation from USDA suggested since our p value is greater than 0.05. 

--

- However, compared to high income countries, lower middle and upper middle income countries on average have a .077 and .083 higher recovery rate holding deviation total constant. 

---
## Comparing Models

--

.pull-left[
```{r Linear_Model_no_income_graph, echo = FALSE, warning=FALSE, message=FALSE}
res <- linear_reg() %>%
  set_engine("lm") %>%
  fit(rec_rate ~ deviation_tot, data = food) 

res_aug <-augment(res$fit)

ggplot(res_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Recovery Rate", y = "Residuals", title = "Residual")
```
]

--

.pull-right[
```{r Linear_Model_with_income_graphres, echo = FALSE, warning=FALSE, message=FALSE}
resincome <- linear_reg() %>%
  set_engine("lm") %>%
  fit(rec_rate ~ deviation_tot+income, data = food) 

resincome_aug <-augment(resincome$fit)

ggplot(resincome_aug, mapping = aes(x = .fitted, y = .resid)) +
  geom_point(alpha = 0.5) +
  geom_hline(yintercept = 0, color = "gray", lty = "dashed") +
  labs(x = "Recovery Rate", y = "Residuals")
```
]

--
.pull-left[
#### Adjusted R Squared without income
```{r lLinear_Model_no_income_r2, echo = FALSE, warning=FALSE, message=FALSE}
linear<-lm(rec_rate~deviation_tot, data=food)
glance(linear)$adj.r.squared %>% 
  print()
```
]

--


.pull-right[
#### Adjusted R Squared with income
```{r lLinear_Model_with_income_r2, echo = FALSE, warning=FALSE, message=FALSE}
reslinear<-lm(rec_rate~deviation_tot+income, data=food)
glance(reslinear)$adj.r.squared %>% 
  print()
```
]


- This model has a larger adjusted r squared value, (3.7% compared to 2.8%) indicated that it accounts for more variance in the data than the first model that did not include income.

---
# Discussion

### Conclusion

- Significant relationship between dietary deviation and COVID-19 Recovery Rates
--

### Limitations

- Vaccination Rates

--

- Variation of Individual Ideas

--

### Future Directions

- Control for vaccination rates

--

- Investigate individuals diet




