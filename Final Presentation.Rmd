---
title: "Final Presentation"
author: "Arthi Vaidyanathan and Denise Shkurovich"
date: "11/16/2021"
output:
  pdf_document: default
  html_document: default
---

```{r setup, include=FALSE, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r load-packages, message = FALSE, warning = FALSE, echo = FALSE}
library(tidyverse) 
library(tidymodels)
```

```{r load-data, message = F, echo = FALSE}
food <- readr::read_csv("data/Food_Supply_kcal_Data.csv")
```

# Introduction and Data:

We are interested in looking at the relationship between COVID-19 outcomes and nutrition worldwide. The USDA Center for Nutrition Policy and Promotion suggests a dietary intake which consists of 30% grains, 40% vegetable, 10% fruits, and 20% proteins (dietaryguidlines.gov). Previous studies demonstrate an increased mortality in patients infected with COVID-19 which have chronic inflammatory diseases such as obesity, diabetes, and hypertension.
  
The prevalence of these chronic inflammatory diseases are known to be correlated with an individual's diet (Onishi 2020). Furthermore, previous studies show that maintaining a healthy diet can decrease risk of severe infection by promoting the immune system (Messina et al. 2020, Iddir et. al 2020). Adequate protein consumption is essential for antibody production and poor nutrient consumption has been shown to increase inflammation and oxidative stress (Iddir et. al 2020). We are ultimately interested in seeing if countries that tend to consume similar diets to those suggested by the USDA show decreased rates of mortality from COVID-19 and how it/if it is related to income levels. We also explored each nutritional group in isolation as well as alcohol consumption, fat consumption, obesity, and undernourishment to analyze if there was a significant correlation with COVID recovery rates across countries. 

This dataset, “COVID-19 Healthy Diet Dataset” comes from Kaggle. The dataset provides energy intake (kcal) as percentages of total diet by food group. In addition, it provides percentages of obesity and undernourished individuals. Finally it provides data for total confirmed COVID-19 cases, recovered COVID cases, COVID deaths, and active COVID cases for 170 countries. The food supply quantities in addition to the prevalence of obesity and undernourishment in the populations were obtained from the Food and Agricultural Organization of the United Nations, the population count was taken from the Population Reference Bureau, and the Johns Hopkins Center for Systems Science and Engineering was used for COVID-19 data and all data was last updated in February of 2021. The Food and Agricultural Organization of the United Nations as well as the Johns Hopkins Center for Systems Science and Engineering did not specify the methodology used to collect their data. In addition, data on the income group classification of each country was obtained from the World Bank. 

### Works Cited: 

Iddir M., et al. Strengthening the Immune System and Reducing Inflammation and Oxidative Stress through Diet and Nutrition: Considerations during the COVID-19 Crisis. Nutrients. 2020;12(6):1562.

Messina G., et al. Functional Role of Dietary Intervention to Improve the Outcome of COVID-19: A Hypothesis of Work. International Journal of Molecular Sciences. 2020; 21(9):3104

Onishi J., et al. Can Dietary Fatty Acids Affect the COVID-19 Infection Outcome in Vulnerable Populations? mBio. 11(4).

# Exploratory Data Analysis

```{r make_food_categories, echo = FALSE, warning=FALSE}
food <- food %>% 
  mutate(Grains = `Cereals - Excluding Beer` + `Starchy Roots`) %>% 
  mutate(Vegetables2 = Pulses + `Vegetal Products` + Vegetables) %>% 
  mutate(Fruits = `Fruits - Excluding Wine`) %>% 
  mutate(Fats = `Animal fats` + Oilcrops + Treenuts + `Vegetable Oils`) %>% 
  mutate(Protein = `Animal Products` + Eggs + `Fish, Seafood` + Meat + `Milk - Excluding Butter` + Offals) %>% 
  mutate('Alcohol/Stimulants' = `Alcoholic Beverages` + Stimulants) %>% 
  mutate(Other = `Aquatic Products, Other` + Miscellaneous + Spices + `Sugar Crops` + `Sugar & Sweeteners`)
```

Our dataset included more specific dietary composition than the USDA values. Therefore, to be able to compare them, we grouped the datasets into broader dietary categories including grains, vegetables, fruits, fats, proteins, and a general miscellaneous category. We did so by reading the descriptions of what composes each variable in the dataset. 

```{r countries-mean-graph, echo = FALSE, warning=FALSE}

meanfood <- food %>%
  summarize(Group = "Countries", meangrains = mean(Grains), meanveg = mean(Vegetables2), meanfruit = mean(Fruits), meanfat = mean(Fats), meanprotein = mean(Protein), meanother = mean(Other)) %>% 
 add_row(Group = "USDA", meangrains=30, meanveg=40, meanfruit=10, meanprotein=20) %>% 
    pivot_longer(cols=meangrains:meanother, names_to = "Means", values_to = "PercentDiet")

meanfood %>%
  ggplot(aes(x=Means, y=PercentDiet, fill=Group))+geom_col(position="dodge") + labs(x="Food Group", y="Percent of Total Diet Composition", title="Avergae Diet Make up by Food Group", subtitle="Compared to USDA suggested diet") + theme(axis.text.x = element_text(angle = 45, vjust = 0.5))

```

We were then curious to see if the mean percentages of the dietary categories of countries generally aligned with the USDA values. This helps inform us if we are making a valid comparison between the data and USDA values for the duration of the project. In order to do so we calculated the means of each of the values and added an additional column with the USDA values before plotting the bar graph. As shown, the values for grains, proteins, and vegetables are comparable to the USDA values indicating that our grouping of variables likely successfully captured the majority of dietary groups belonging to the broader categories. The value for fruits is significantly lower indicating that either the dataset does not accurately capture fruit consumption or countries on average eat significantly less fruit than recommended by the USDA. Furthermore, while USDA does not provide a value for suggested fat, it is a nutritional group significantly represented in our data set.
  
```{r countries, echo = FALSE, warning=FALSE}
food <- food %>% #grouping each country by their income classification group
  mutate(income = ifelse(Country %in% c("Afghanistan","Burkina Faso", "Central African Republic", "Chad", "Congo", "Ethiopia", "Gambia", "Guinea", "Guinea-Bissau", "Korea, Dem. People's Rep", "Liberia", "Madagascar", "Malawi", "Mali", "Mozambique", "Rwanda", "Sierra Leone", "Sudan", "Togo", "Uganda", "Yemen"),"LIC", 
                         ifelse(Country %in% c("Algeria","Angola","Bangladesh", "Belize", "Benin", "Bolivia", "Cabo Verde", "Cambodia", "Cameroon", "Cote d'Ivoire", "Djibouti", "Egypt", "El Salvador", "Eswatini", "Ghana", "Haiti", "Honduras", "India", "Indonesia", "Iran (Islamic Republic of)", "Kenya", "Kiribati", "Kyrgyzstan", "Lao People's Democratic Republic", "Lesotho", "Mauritania", "Mongolia", "Morocco", "Myanmar", "Nepal", "Nicaragua", "Niger", "Nigeria", "	
Pakistan", "Samoa", "Sao Tome and Principe", "Senegal", "Solomon Islands","Sri Lanka", "Suriname", "Tajikistan", "Timor-Leste", "Tunisia", "Ukraine", "United Republic of Tanzania", "Uzbekistan", "Vanuatu", "Vietnam", "Zambia", "Zimbabwe"), "LMIC", 
                         ifelse(Country %in% c("Albania","Argentina","Armenia","Azerbaijan", "Belarus","Bosnia and Herzegovina", "Botswana", "Brazil", "Bulgaria", "China", "Colombia", "Costa Rica", "Cuba", "Dominica", "Dominican Republic", "Ecuador", "Fiji", "Gabon", "Georgia", "Grenada", "Guatemala", "Guyana", "Iraq", "Jamaica", "Jordan", "Kazakhstan", "Lebanon", "Malaysia", "Maldives", "Mauritius", "Mexico", "Montenegro","Namibia", "North Macedonia", "	
Panama", "Paraguay", "Peru", "Philippines", "Republic of Moldova", "Romania", "Russian Federation", "Saint Lucia", "Saint Vincent and the Grenadines", "Serbia", "Senegal", "South Africa", "Thailand", "Turkey", "Turkmenistan", "Venezuela (Bolivarian Republic of)"),
             "UMIC", "HIC"))))
```

One of the major confounding factors to consider in both dietary consumption as well as COVID-19 outcomes is income. Since some foods such as grains are typically cheaper than others such as proteins, income could play a significant role as a confounding factor. In order to account for this discrepancy we created a new income variable and classified each country according to their World Bank income status. HIC refers to high income countries, UMIC refers to upper middle income countries, LMIC refers to lower middle income countries, and LIC refers to low income countries.


```{r comparing_dietary_means_to_USDA, echo = FALSE, warning=FALSE}
meanfoodincome <- food %>%
  group_by(income) %>%
  summarize(meangrains = mean(Grains), meanveg = mean(Vegetables2), meanfruit = mean(Fruits), meanfat = mean(Fats), meanprotein = mean(Protein), meanother = mean(Other)) %>% 
  add_row(income="USDA", meangrains=30, meanveg=40, meanfruit=10, meanprotein=20) %>% 
  pivot_longer(cols=meangrains:meanother, names_to = "Means", values_to = "PercentDiet") 

meanfoodincome %>%
  mutate(income = fct_relevel(income, 
            "HIC", "UMIC", "LMIC", 
            "LIC", "USDA")) %>%
  ggplot(aes(x=Means, y=PercentDiet, fill=income))+geom_col(position="dodge") + labs(x="Food Group", y="Percent of Total Diet Composition", title="Diet Composition by Food Group", subtitle="broken down by income category and compared to USDA suggested diet") + theme(axis.text.x = element_text(angle = 45, vjust = 0.5))
```
In this graph, we summarized the break down of diet by income country in comparison to the  recommended values from USDA. This visualization shows that low income countries seem to be consuming less than the recommended amount of protein and more grains than recommended. We can also see that higher income countries consume more protein and less grains than lower income countries. This graph suggests that in our analysis we should in fact include income level as a possible predictor of COVID outcomes since countries seem to show trends in their nutrition in most categories by income level. 

```{r, ANOVA_grains, echo=FALSE, warning=FALSE}
summary(aov(Grains~income,data=food))
```
Using the overall F test, we identified a significant difference in percent of diet that comes from grains among income groups. Our p value is <<0.001.
```{r, ANOVA_veg, echo=FALSE, warning=FALSE}
summary(aov(Vegetables2~income,data=food))
```
Using the overall F test, we identified a significant difference in percent of diet that comes from vegetables among income groups. Our p value is <<0.001.
```{r, ANOVA_Fruit, echo=FALSE, warning=FALSE}
summary(aov(Fruits~income,data=food))
```
There are no significant differences in percent of diet that comes from fruit among income groups. Our p value is great than 0.05.
```{r, ANOVA_Fats, echo=FALSE, warning=FALSE}
summary(aov(Fats~income,data=food))
```
Using the overall F test, we identified a significant difference in percent of diet that comes from fats among income groups. Our p value is <<0.001.
```{r, ANOVA_Protein, echo=FALSE, warning=FALSE}
summary(aov(Protein~income,data=food))
```
Using the overall F test, we identified a significant difference in percent of diet that comes from proteins among income groups. Our p value is <<0.001.
```{r, ANOVA_alc, echo=FALSE, warning=FALSE}
summary(aov(`Alcohol/Stimulants`~income,data=food))
```
Using the overall F test, we identified a significant difference in percent of diet that comes from Alchogol/Stimulants among income groups. Our p value is <<0.001.
```{r, ANOVA_obesity, echo=FALSE, warning=FALSE}
summary(aov(Obesity~income,data=food))
```
Using the overall F test, we identified a significant difference in percent of the population that is obese among income groups. Our p value is <<0.001.
```{r, ANOVA_malnourish, echo=FALSE, warning=FALSE}
food <- food %>% 
  mutate(Malnourish= ifelse(Undernourished=="<2.5",2.5,Undernourished))
summary(aov(Malnourish~income, data=food))
```
Using the overall F test, we identified a significant difference in percent of the population that is malnourished among income groups. Our p value is <<0.001.

```{r box-plot, massage = FALSE, echo = FALSE, fig.height = 3, fig.width = 7, warning=FALSE}
food <- food %>%
  mutate(rec_rate=Recovered/Confirmed) %>% 
  filter(rec_rate > 0)

food %>%
  mutate(income = fct_relevel(income, 
            "HIC", "UMIC", "LMIC", 
            "LIC", "USDA")) %>%
  ggplot(aes(x = rec_rate, fill = income)) + geom_boxplot() + labs(y = NULL, x = "Percent Recovery for Confirmed Covid Cases", fill = "Income Status", title = "Boxplot Showing COVID Recovery Data Group 
by Country Income Status")
```
In order to further our analysis, we created a variable that quantifies the COVID recovery rate for each country for comparison. We did this by dividing the percentage people in a country that recovered from COVID over the percentage of total people in that country that were confirmed COVID cases to obtain a rate of what percentage of people in that country that had COVID were able to recover. We also explored if income had an effect on percent recovery for COVID. High income countries hypothetically might have more resources to be able to provide better care for their citizens and improve their recovery rate. However, according to the boxplot, countries in the 4 income groups seem to have comparable recovery rates with the median for UMIC actually being the highest by a slight margin. Furthermore, the HIC group has numerous outliers near around 0.3 which might be important to consider. This seemed unusual to us due to the nature of disease and the resources the countries have. We speculate that more serious cases might be reported at disproportionately higher rates or there might potentially be other sources of error in the data set that we will later discuss. 

```{r anova_for_rec_rate_and_income,echo = FALSE, warning=FALSE}
summary(aov(rec_rate~income,data=food))
```
Based on the graphs, we wanted to see whether the mean recovery rate were significantly different between any of the income categories. ANOVA depends on variation between groups/within groups. From our graphs we can see that there is a decent amount of variation in recovery rate within each income category. This is probably due to the fact that these categories are very broad and there is different medical care/amount of COVID cases in each country even within income groups. However, the results of the ANOVA are not significant so therefore we cannot reject the null hypothesis that there are no significant differences due to income in recovery rate from COVID-19.

```{r creating_deviation_varibles, echo = FALSE, warning=FALSE}
food <- food %>% 
  mutate(deviance_grains = (30 - Grains)^2) %>% 
  mutate(deviance_veg = (40 - Vegetables2)^2) %>% 
  mutate(deviance_fruit = (10 - Fruits)^2) %>% 
  mutate(deviance_protein = (20 - Protein)^2) %>% 
  mutate(deviance_tot = deviance_grains + deviance_protein + deviance_fruit + deviance_veg) %>% 
  filter(rec_rate>0)
```
We created a variable for how much the average diet in each country differs from the suggested USDA value. We did so by subtract the mean value from each food group from the USDA value and then squaring that value. We then summed up this value from each food group to create deviance total variable. We squared them to account for negative values if the average diet was less than the USDA value for a certain category as well as increase the spread of deviance values for better comparison and visualization.

```{r graphs_of_deviance_vs_recovery rate, echo = FALSE, warning=FALSE}
food %>% 
  filter(deviance_tot<750) %>% 
ggplot(aes(x = deviance_tot, y = rec_rate)) +
  geom_point()+geom_smooth(method="lm") + labs(
    title = "COVID-19 Recovery Rate in relationship to deviation from USDA suggested Dietary Intake",
    subtitle="linear model by income category",
    x = "Deviation from USDA suggested diet",
    y = "COVID-19 Recovery Rate")

food %>% 
  filter(deviance_tot<750) %>% 
ggplot(aes(x = deviance_tot, y = rec_rate, color=income)) +
  geom_point()+geom_smooth(method="lm", se = FALSE) + labs(
    title = "COVID-19 Recovery Rate in relationship to deviation from USDA suggested Dietary Intake",
    x = "Deviation from USDA suggested diet",
    y = "COVID-19 Recovery Rate")

```
Here we compared the relationship between deviation from USDA suggested intake with recovery rates from COVID-19. The recovery rates were calculated by calculated the percent of the population that recovered from COVID-19 with the percent of the population that was diagnosed with COVID-19.

In the first graph, we see that there is a negative correlation between recovery rates and deviation from USDA suggested dietary intake. This suggests that as ones dietary intake begins to differ from the USDA suggested intake, they on average seem to have a lower change of recovering from COVID-19.

To further look at this relationship, we compared this relationship by income level. We can see that while lower middle income and upper middle income countries have a slighty negative relationship, lower income countries almost show no relationship between deviation rate and recovery rate. In contrast, high income countries show the strongest correlation between deviation rate and recovery rate. 

WHY?

```{r Linear_Model, echo = FALSE, warning=FALSE}
res <- linear_reg() %>%
  set_engine("lm") %>%
  fit(rec_rate ~ deviance_tot, data = food) %>% 
  tidy() %>% 
  print()
```
This linear model shows that there is a significant relationship between recovery rate and deviation rate since our p value is less than the alpha level of 0.05. For every integer increase in deviance rate, the chances of recovering are on average 0.0002 lower. 

SUMMARY

LIMITATIONS

CONCLUSIONS